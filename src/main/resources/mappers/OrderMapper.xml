<?xml version="1.0" encoding="utf-8"?>
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="com.briup.estore.dao.OrderMapper">
 	<resultMap type="Book" id="BookResult">
 		<id column="b_id" property="id" />
 		<result column="name" property="name"/>
 		<result column="price" property="price"/>
 		<result column="image" property="image"/>
 	</resultMap>
 	
 	<resultMap type="OrderLine" id="LineResult" >
 		<id column="l_id" property="id"/>
 		<result column="num" property="num"/>
 		<association property="book" resultMap="BookResult" />
 	</resultMap>
 	
 	<insert id="saveLine" parameterType="OrderLine" useGeneratedKeys="true" keyProperty="id">
 		insert into orderline values(#{id},#{num},#{book.id},#{order.id})
 	</insert>
 	
 	<insert id="save" parameterType="Order">
 		insert into orders values(#{id},#{total},#{orderDate},#{customer.id})
 	</insert>
 	
 	<select id="selectByCus" parameterType="int" resultType="Order">
 	select * from orders
 	where customer_id = #{id}
	</select>
	
	
	<select id="selectLineByOrder" parameterType="String" resultMap="LineResult">
	select l.id l_id,num,b.id b_id,name,price,image from orderline l,book b
	where b.id = l.book_id and order_id = #{id}
	</select>
	
	<delete id="delOrderById" parameterType="String">
		delete from orders
		where id = #{id}
	</delete>
	<delete id="delLineByOrder" parameterType="String">
		delete from orderline
		where order_id = #{id}
	</delete>
 </mapper>